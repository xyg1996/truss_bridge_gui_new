echo 开始流体准备！
currentpath=$1
echo $currentpath
cd $currentpath

source ~/.bashrc
# module load x86/Intel_Development_Tool/2018

# GCCPATH=/home/export/online3/amd_share/gcc5.4
# export PATH=$GCCPATH/gcc-5.4.0/x86Install/bin:${PATH}
# export LD_LIBRARY_PATH=$GCCPATH/gcc-5.4.0/x86Install/lib64:${LD_LIBRARY_PATH}
# export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$GCCPATH/gmp-4.2.4/lib:$GCCPATH/mpc-0.8.2/SWInstall/lib:$GCCPATH/mpfr-2.4.2/SWInstall/lib

# BOOST_ROOT=/home/export/online3/amd_share/precicerequirement/boost169
# export LIBRARY_PATH=$BOOST_ROOT/lib:${LIBRARY_PATH};
# export LD_LIBRARY_PATH=$BOOST_ROOT/lib:${LD_LIBRARY_PATH};
# export CPLUS_INCLUDE_PATH=$BOOST_ROOT/include:${CPLUS_INCLUDE_PATH};

# export LD_LIBRARY_PATH=/home/export/online3/amd_share/precicerequirement/yamlcpp062/lib:${LD_LIBRARY_PATH}
# export CPLUS_INCLUDE_PATH=/home/export/online3/amd_share/precicerequirement/yamlcpp062/include:$CPLUS_INCLUDE_PATH

# export Eigen3_ROOT=/home/export/online3/amd_share/precicerequirement/eigen-eigen-323c052e1731

# export PATH=/home/export/online3/amd_share/precicerequirement/cmake/bin:${PATH};

# PRECICE_ROOT=/home/export/online3/amd_share/precicerequirement/preCICE1.6.1
# export PKG_CONFIG_PATH=$PRECICE_ROOT/lib/pkgconfig
# export LIBRARY_PATH=$PRECICE_ROOT/lib:${LIBRARY_PATH};
# export LD_LIBRARY_PATH=$PRECICE_ROOT/lib:${LD_LIBRARY_PATH};
# export CPLUS_INCLUDE_PATH=$PRECICE_ROOT/include:${CPLUS_INCLUDE_PATH};

#. /home/export/online3/amd_share/OpenFOAM_x86/OpenFOAM-5.0/etc/bashrc
# . /home/export/online3/amd_share/OpenFOAM_x86/OpenFOAM-6.0/etc/bashrc


# wmUNSET 2>/dev/null; source ${HOME}/installer/OpenFOAM-3.0.0/OpenFOAM_SW/OpenFOAM-3.0.0/etc/bashrc
alias of300sw='wmUNSET 2>/dev/null; source /home/export/online3/amd_share/OpenFOAM_SW/OpenFOAM-3.0.0/etc/bashrc'
of300sw
. $WM_PROJECT_DIR/bin/tools/RunFunctions
# Fluid participant

# Run this script in one terminal and the "runSolid" script in another terminal.
# These scripts present how the two participants would be started manually.
# Alternatively, you may execute the "Allrun" script in one terminal.

# Run this script with "-parallel" for parallel simulations

# The script "Allclean" cleans-up the result and log files.

# Mesh
cd Fluid
    procs=$(getNumberOfProcessors)
#cd ..

#rm -rfv Fluid/0/*
#cp -r Fluid/0.orig/ Fluid/0/
#blockMesh -case Fluid
/usr/sw-mpp/bin/bsub -I -q q_sw_share -n 1 -share_size 7000 -host_stack 1024 -o log.blockMesh blockMesh
/usr/sw-mpp/bin/bsub -I -q q_sw_share -n 1 -share_size 7000 -host_stack 1024 -o log.decompose decomposePar -force
#decomposePar -case Fluid -force

#cd Fluid

echo "generate fluid mesh...."
/usr/sw-mpp/bin/bsub -I -q q_sw_share -n $procs -share_size 7000 -host_stack 1024 -o log.SHM snappyHexMesh -overwrite -parallel 

/usr/sw-mpp/bin/bsub -I -q q_sw_share -n 1 -share_size 7000 -host_stack 1024 -o log.reconParMesh reconstructParMesh -mergeTol 1e-6 -constant

/usr/sw-mpp/bin/bsub -I -q q_sw_share -n 1 -share_size 7000 -host_stack 1024 -o log.reconPar reconstructPar -constant

/usr/sw-mpp/bin/bsub -I -q q_sw_share -n 1 -share_size 7000 -host_stack 1024 -o log.renumberMesh renumberMesh -overwrite

/usr/sw-mpp/bin/bsub -I -q q_sw_share -n 1 -share_size 7000 -host_stack 1024 -o log.checkMesh checkMesh

echo "set the initial fields...."
/usr/sw-mpp/bin/bsub -I -q q_sw_share -n 1 -share_size 7000 -host_stack 1024 -o log.setFields setFields
#/usr/sw-mpp/bin/bsub -I -q q_x86_share -n $procs -o log.setFields setFields -parallel


# Run
#cd Fluid
    solver=$(getApplication)
#cd ..
echo $solver

/usr/sw-mpp/bin/bsub -I -q q_sw_share -n 1 -share_size 7000 -host_stack 1024 -o log.decompose decomposePar -force

# cp -rf Fluid/constant/g_ac Fluid/constant/g
# cp -rf Fluid/system/controlDict_ac Fluid/system/controlDict
# /usr/sw-mpp/bin/bsub -I -q q_x86_share -n $procs -o log.$solver -case Fluid $solver -parallel

# cp -rf Fluid/constant/g_sh Fluid/constant/g
# cp -rf Fluid/system/controlDict_sh Fluid/system/controlDict
# /usr/sw-mpp/bin/bsub -I -q q_x86_share -n $procs -o log.$solver -case Fluid $solver -parallel

echo 流体准备已结束,生成在如下的目录：
echo $currentpath
echo 请点击开始计算继续



currentpath=$1
echo $currentpath
cd $currentpath

jobid=$2
echo 正尝试重新连接之前的任务:$jobid

#ssh 41.0.0.188 << "EOF"
#ssh 41.0.0.188 currentpath="$currentpath" bash -s << "EOF"
#ssh 41.0.0.17 currentpath="$currentpath" bash -s << "EOF"

# ln -s -f precice-config_parallel.xml precice-config.xml
# rm -rf log.ccx_preCICE
# /usr/sw-mpp/bin/bsub -I -q q_x86_share -o log.ccx_preCICE /home/export/online3/amd_share/precicerequirement/ccx_preCICE -i Solid/tankpre -precice-participant Calculix &&

/usr/sw-mpp/bin/bonline $jobid

# if 第一阶段执行成功,并且第二阶段还没执行过:
if [[ -f Solid/tankpre.rout && ! -f Solid/tank.rin ]]; then
    source ~/.bashrc

    module load x86/Intel_Development_Tool/2018

    GCCPATH=/home/export/online3/amd_share/gcc5.4
    export PATH=$GCCPATH/gcc-5.4.0/x86Install/bin:${PATH}
    export LD_LIBRARY_PATH=$GCCPATH/gcc-5.4.0/x86Install/lib64:${LD_LIBRARY_PATH}
    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$GCCPATH/gmp-4.2.4/lib:$GCCPATH/mpc-0.8.2/SWInstall/lib:$GCCPATH/mpfr-2.4.2/SWInstall/lib

    BOOST_ROOT=/home/export/online3/amd_share/precicerequirement/boost169
    export LIBRARY_PATH=$BOOST_ROOT/lib:${LIBRARY_PATH};
    export LD_LIBRARY_PATH=$BOOST_ROOT/lib:${LD_LIBRARY_PATH};
    export CPLUS_INCLUDE_PATH=$BOOST_ROOT/include:${CPLUS_INCLUDE_PATH};

    export LD_LIBRARY_PATH=/home/export/online3/amd_share/precicerequirement/yamlcpp062/lib:${LD_LIBRARY_PATH}
    export CPLUS_INCLUDE_PATH=/home/export/online3/amd_share/precicerequirement/yamlcpp062/include:$CPLUS_INCLUDE_PATH

    export Eigen3_ROOT=/home/export/online3/amd_share/precicerequirement/eigen-eigen-323c052e1731

    export PATH=/home/export/online3/amd_share/precicerequirement/cmake/bin:${PATH};

    PRECICE_ROOT=/home/export/online3/amd_share/precicerequirement/preCICE1.6.1
    export PKG_CONFIG_PATH=$PRECICE_ROOT/lib/pkgconfig
    export LIBRARY_PATH=$PRECICE_ROOT/lib:${LIBRARY_PATH};
    export LD_LIBRARY_PATH=$PRECICE_ROOT/lib:${LD_LIBRARY_PATH};
    export CPLUS_INCLUDE_PATH=$PRECICE_ROOT/include:${CPLUS_INCLUDE_PATH};

    #开始第二阶段
    ln -s -f precice-config_parallel2.xml precice-config.xml
    cp Solid/tankpre.rout Solid/tank.rin
    rm -rf log.ccx_preCICE
    /usr/sw-mpp/bin/bsub -I -q q_x86_share -o log.ccx_preCICE /home/export/online3/amd_share/precicerequirement/ccx_preCICE -i Solid/tank -precice-participant Calculix
fi